# 자바 동작 원리

동작 원리를 알기 전에 문저 실행 과정을 먼저 알아야함

## 실행 과정

![그림](/study/pic/java_code.PNG)

1. 내가 `자바 파일(java Sourse)`을 작성하면

   > 확장자 ###.java

1. 자바 컴파일러를 통해 `자바 바이트코드 (java Byte Code)` 로 바꿈

1. 컴파일된 바이트코드를 `JVM` 의 `클래스로더(Class Loader)` 로 전달되고

1. 클래스로더는 필료한 클래스들을 로딩 및 링크하여 `런타임 데이터 영역(Runtime Data area)`

   JVM 메모리에 올림

1. 그리고 `실행엔진(Execution Engine)`이 JVM 에 있는 바이크 코드들을 하나씩 가져와 실행하면서

   그때 그때 필요한 클래스들을 클래스로더에게 요청함

   > 클래스로더가 다 메모리에 올리는게 아님 메모리 낭비를 줄이기 위해

## JVM (Java Virtual Machine)

가상머신이란?

    하드웨어를 소프트웨어적으로 구현해서 거기서 운영체제가 작동하도록 하는 기술

그럼 자바가상 머신은 뭐냐

    Java로 개발한 프로그램을 컴파일하여 만들어지는 바이트코드를 실행시키기 위한 가상머신.

- JVM 의 구성은

  1. 클래스 로더

  2. 런타임 데이터 영역

  3. 실행 엔진

### 클래스 로더

클래스 로더란?

     Java 클래스를 로드하는 역할을 한다. 클래스 로더에는 로딩, 링크, 초기화 단계로 나뉘어져 있음

클래스를 로드 할때는 parent-first/child-last의 순서로 로드

캐시->부모->자식의 순서로 클래스 로딩됨

- 로딩

  .class 파일을 jvm 메모리에 로드하는 과정임

- 링킹

  링크는 3가지로 나뉨

  1. 검증

     바이트코드가 제대로 규칙을 준수되어 있는 검사

  1. 준비

     클래스파일이 필요로 하는 메모리의 양을 할당해줌

  1. 분석

     클래스파일이 참조하는 객체에 대해서 실제 메모리 주소값을 대입

- 초기화

  클래스 안에 있는 `Static` 변수 및 메소드를 할당, 초기화 시키는 거

#### 클래스 로더 계층 구조

![클래스로더 사진](/study/pic/classLoader.png)

1. 부트스트랩 클래스 로더 (Bootstrap Class Loader)

   JVM 시작 시 가장 최초로 실행되는 클래스 로더

   자바의 기본적인 클래스를 로드하게됨

2. 확장 클래스 로더 (Extension Class Loader)

   자바 기본 클래스를 제외한 확장된 클래스를 로드

3. 시스템 클래스 로더 (System Class Loader)

   자바를 실행할때 사용자가 지정한 classPath 거기 클래스를 로드함

4. 유저 지정 클래스 로더 (User-defined Class loader)

   직접 작성한 class를 로드

#### 위임 모델

바이트코드를 넘겨 받은 클래스 로더가 필요한 클래스들을 로드할때

요청 받는 순서

1. 클래스 로더 캐시

   이전에 로드된 클래스인지 클래스 로더 캐시를 확인

1. 상위 클래스 로더

   없으면 상위 클래스를 하나씩 거슬러 올라감

1. 자기 자신

   부트스트랩 클래스로더 까지 올라갔는데 없으면 자기자신

#### 가시성 제한

클래스 로드를 요청 받았을때 위임 모델에 의해서 막 찾고 있을때

(클래스 로더 캐시에서부터 상위 클래스 로더들을 확인 하는 과정)

이때 하위 클래스 로더에 있는 클래스는 확인이 불가능함

#### 언로드(Unload) 불가

클래스를 로드 하는 건 쌉 가능이지만

`언로드(Unload)` 하는 것은 불가능

#### 이름 공간(Name Space)

<!-- 로드된 클래스들을 보관하는 공간?? -->

위임 모델을 통해 클래스들을 확인하는데에 공간이 여기임

보관 기준은 (Full Qualified Class Name) 패키미명까지 포함된 식별자를 뜻함

---

이렇게 해서 Runtime Data Area 로 로드 시킴

## 레퍼런스

출처 - [JVM 동작원리 및 기본개념](https://steady-snail.tistory.com/67)

출처 - [[Java] JVM의 클래스 로더란\_](https://steady-coding.tistory.com/593)
